ASC INVENTORY - CONFIGURATION SNAPSHOT
Generated: 2026-02-14
Scope: Runtime configuration and environment requirements as implemented in code and configuration files

================================================================================
SECTION 1: ENVIRONMENT VARIABLES
================================================================================

Variable: NODE_ENV
Purpose: Runtime environment mode (development/production)
Consuming files:
  apps/api/src/index.ts (line 69: logger transport selection)
  apps/api/src/index.ts (line 242: PHI governance enforcement)
  apps/api/src/plugins/clinic-auth.ts (line 19: secret validation)
  apps/api/Dockerfile (line 49: ENV NODE_ENV=production)
Defining files:
  apps/api/.env (line 1)
  docker-compose.yml (line 28)
  docker-compose.prod.yml (line 57)

Variable: PORT
Purpose: API server listening port
Consuming files:
  apps/api/src/index.ts (line 62)
Defining files:
  apps/api/.env (line 2)
  apps/api/Dockerfile (line 50: ENV PORT=3001)
  docker-compose.yml (line 29)
  docker-compose.prod.yml (line 58)

Variable: HOST
Purpose: API server binding host address
Consuming files:
  apps/api/src/index.ts (line 63)
Defining files:
  UNKNOWN (defaults to 0.0.0.0 in code)

Variable: LOG_LEVEL
Purpose: Logging verbosity level
Consuming files:
  apps/api/src/index.ts (line 68)
Defining files:
  UNKNOWN (defaults to 'info' in code)

Variable: DB_HOST
Purpose: PostgreSQL host address
Consuming files:
  apps/api/src/db/index.ts (line 9)
Defining files:
  apps/api/.env (line 3)
  docker-compose.yml (line 30)
  docker-compose.prod.yml (line 59)

Variable: DB_PORT
Purpose: PostgreSQL port number
Consuming files:
  apps/api/src/db/index.ts (line 10)
Defining files:
  apps/api/.env (line 4)
  docker-compose.yml (line 31)
  docker-compose.prod.yml (line 60)

Variable: DB_NAME
Purpose: PostgreSQL database name
Consuming files:
  apps/api/src/db/index.ts (line 11)
Defining files:
  apps/api/.env (line 5)
  docker-compose.yml (line 32)
  docker-compose.prod.yml (line 61)

Variable: DB_USER
Purpose: PostgreSQL username
Consuming files:
  apps/api/src/db/index.ts (line 12)
Defining files:
  apps/api/.env (line 6)
  docker-compose.yml (line 33)
  docker-compose.prod.yml (line 62)

Variable: DB_PASSWORD
Purpose: PostgreSQL password
Consuming files:
  apps/api/src/db/index.ts (line 13)
Defining files:
  apps/api/.env (line 7)
  docker-compose.yml (line 34)
  docker-compose.prod.yml (line 63: ${POSTGRES_PASSWORD})
  .env.example (line 12: POSTGRES_PASSWORD)

Variable: DB_SSL
Purpose: Enable SSL for PostgreSQL connection
Consuming files:
  apps/api/src/db/index.ts (line 6)
Defining files:
  UNKNOWN (no default in committed files)

Variable: JWT_SECRET
Purpose: Secret key for JWT token signing
Consuming files:
  apps/api/src/index.ts (line 104)
  apps/api/src/plugins/auth.ts (line 69)
Defining files:
  apps/api/.env (line 8)
  docker-compose.yml (line 35)
  docker-compose.prod.yml (line 64: ${JWT_SECRET})
  .env.example (line 15)

Variable: CORS_ORIGIN
Purpose: Allowed CORS origin for API requests
Consuming files:
  apps/api/src/index.ts (line 77)
Defining files:
  apps/api/.env (line 9)
  docker-compose.yml (line 36)
  docker-compose.prod.yml (line 66)

Variable: NEXT_PUBLIC_API_URL
Purpose: API base URL exposed to Next.js client (build-time variable)
Consuming files:
  apps/web/src/lib/api/client.ts (line 20)
Defining files:
  apps/web/.env.local (line 1)
  apps/web/Dockerfile (line 9: ARG NEXT_PUBLIC_API_URL)
  apps/web/Dockerfile (line 15: ENV NEXT_PUBLIC_API_URL)
  docker-compose.yml (line 52)
  docker-compose.prod.yml (line 80: documented as build-time only)

Variable: NEXT_PUBLIC_VERSION
Purpose: Application version exposed to Next.js client (build-time variable)
Consuming files:
  UNKNOWN (build artifact only)
Defining files:
  apps/web/Dockerfile (line 12: ENV from VERSION build arg)

Variable: NEXT_PUBLIC_BUILD_TIME
Purpose: Build timestamp exposed to Next.js client (build-time variable)
Consuming files:
  UNKNOWN (build artifact only)
Defining files:
  apps/web/Dockerfile (line 13: ENV from BUILD_TIME build arg)

Variable: NEXT_PUBLIC_COMMIT_SHA
Purpose: Git commit SHA exposed to Next.js client (build-time variable)
Consuming files:
  UNKNOWN (build artifact only)
Defining files:
  apps/web/Dockerfile (line 14: ENV from COMMIT_SHA build arg)

Variable: OPENAI_API_KEY
Purpose: OpenAI API key for AI features
Consuming files:
  apps/api/src/services/ai.service.ts (line 148)
Defining files:
  apps/api/.env (line 13)

Variable: AI_EXPLAIN_READINESS_ENABLED
Purpose: Feature flag to enable AI readiness explanation endpoint
Consuming files:
  apps/api/src/routes/ai.routes.ts (line 75)
Defining files:
  apps/api/.env (line 12)

Variable: CLINIC_KEY_SECRET
Purpose: HMAC secret for clinic API key authentication (64+ chars required)
Consuming files:
  apps/api/src/plugins/clinic-auth.ts (line 16)
Defining files:
  docker-compose.prod.yml (line 65: ${CLINIC_KEY_SECRET})
  apps/api/src/plugins/clinic-auth.ts (line 13: dev fallback constant)

Variable: POSTGRES_USER
Purpose: PostgreSQL superuser username for container initialization
Consuming files:
  UNKNOWN (postgres container internal)
Defining files:
  docker-compose.yml (line 8)
  docker-compose.prod.yml (line 25)

Variable: POSTGRES_PASSWORD
Purpose: PostgreSQL superuser password for container initialization
Consuming files:
  UNKNOWN (postgres container internal)
Defining files:
  docker-compose.yml (line 9)
  docker-compose.prod.yml (line 26: ${POSTGRES_PASSWORD})
  .env.example (line 12)

Variable: POSTGRES_DB
Purpose: PostgreSQL database name for container initialization
Consuming files:
  UNKNOWN (postgres container internal)
Defining files:
  docker-compose.yml (line 10)
  docker-compose.prod.yml (line 27)

Variable: IMAGE_TAG
Purpose: Docker image version tag for production deployment
Consuming files:
  docker-compose.prod.yml (line 53: ghcr.io/twaynet/asc-inventory-api:${IMAGE_TAG})
  docker-compose.prod.yml (line 74: ghcr.io/twaynet/asc-inventory-web:${IMAGE_TAG})
Defining files:
  .env.example (line 19)

Variable: API_URL
Purpose: Override API base URL for smoke tests
Consuming files:
  apps/api/db/smoke-test-financial-readiness.ts (line 17)
  apps/api/db/smoke-test-surgery-request.ts (line 16)
Defining files:
  UNKNOWN (optional override)

================================================================================
SECTION 2: DEVELOPMENT AND PRODUCTION SCRIPTS
================================================================================

Command: pnpm dev
Service: all (monorepo root)
Port bindings: varies by workspace
File: package.json (line 11)

Command: turbo run dev
Service: all workspaces via Turborepo
Port bindings: varies by workspace
File: package.json (line 11)

Command: pnpm dev:clean
Service: all (monorepo root with Next.js cache clear)
Port bindings: varies by workspace
File: package.json (line 12)

Command: next dev
Service: web
Port bindings: 3000 (default)
File: apps/web/package.json (line 6)

Command: next build
Service: web
Port bindings: none (build-time)
File: apps/web/package.json (line 7)

Command: next start
Service: web
Port bindings: 3000 (default)
File: apps/web/package.json (line 8)

Command: tsx watch --env-file=.env src/index.ts
Service: api
Port bindings: 3001 (from PORT env var)
File: apps/api/package.json (line 8)

Command: node dist/index.js
Service: api
Port bindings: 3001 (from PORT env var)
File: apps/api/package.json (line 10)

Command: docker compose up -d
Service: postgres, api, web
Port bindings: 5432 (postgres), 3001 (api), 3000 (web)
File: docker-compose.yml

Command: docker compose -f docker-compose.prod.yml up -d
Service: postgres, caddy, api, web
Port bindings: 80 (caddy), 443 (caddy)
File: docker-compose.prod.yml

Command: npm run db:migrate
Service: api (database migration)
Port bindings: none (connects to DB)
File: package.json (line 16)

Command: npm run db:seed
Service: api (database seeding)
Port bindings: none (connects to DB)
File: package.json (line 17)

Command: npm run db:check
Service: api (schema sanity check)
Port bindings: none (connects to DB)
File: package.json (line 18)

Command: npm run generate:openapi
Service: contract (code generation)
Port bindings: none
File: package.json (line 23)

Command: npm run generate:client
Service: contract (code generation)
Port bindings: none
File: package.json (line 24)

Command: vitest run
Service: web, api (testing)
Port bindings: none
File: apps/web/package.json (line 10), apps/api/package.json (line 12)

================================================================================
SECTION 3: FEATURE FLAGS
================================================================================

Flag: AI_EXPLAIN_READINESS_ENABLED
Storage: environment variable
Gates: AI readiness explanation endpoint (POST /api/ai/explain-readiness)
Implementation: apps/api/src/routes/ai.routes.ts (line 75)
Default: undefined (feature disabled)
Notes: Must be set to string 'true' to enable

Flag: feature.ai.explain_readiness.enabled
Storage: database (platform_config_key table)
Gates: AI readiness explanation feature (future database-governed flag)
Implementation: apps/api/db/migrations/047_config_registry.sql (line 308)
Default: 'false' (string)
Scope: PLATFORM with FACILITY override allowed
Risk class: MEDIUM

Flag: killswitch.ai.all
Storage: database (platform_config_key table)
Gates: Emergency disable all AI features
Implementation: apps/api/db/migrations/047_config_registry.sql (line 332)
Default: 'false' (string)
Scope: PLATFORM only (no facility override)
Risk class: CRITICAL

Flag: killswitch.external_integrations.all
Storage: database (platform_config_key table)
Gates: Emergency disable all external API calls
Implementation: apps/api/db/migrations/047_config_registry.sql (line 336)
Default: 'false' (string)
Scope: PLATFORM only (no facility override)
Risk class: CRITICAL

Flag: feature.loaner_tracking.enabled
Storage: database (platform_config_key table)
Gates: Loaner set tracking features
Implementation: apps/api/db/migrations/047_config_registry.sql (line 323)
Default: 'true' (string)
Scope: PLATFORM with FACILITY override allowed
Risk class: LOW

Flag: feature.financial_attribution.enabled
Storage: database (platform_config_key table)
Gates: Financial attribution tracking
Implementation: apps/api/db/migrations/047_config_registry.sql (line 327)
Default: 'true' (string)
Scope: PLATFORM with FACILITY override allowed
Risk class: LOW

================================================================================
SECTION 4: CONTAINER AND DOCKER CONFIGURATION
================================================================================

Docker Compose Files
--------------------
docker-compose.yml (development mode)
docker-compose.prod.yml (production mode)

Dockerfiles
-----------
apps/api/Dockerfile (multi-stage: builder + production)
apps/web/Dockerfile (single-stage with Next.js build)

Named Volumes (docker-compose.yml)
----------------------------------
postgres_data
  Purpose: PostgreSQL data directory persistence
  Mount: /var/lib/postgresql/data (container)

Named Volumes (docker-compose.prod.yml)
---------------------------------------
postgres_data
  Purpose: PostgreSQL data directory persistence
  Mount: /var/lib/postgresql/data (container)

caddy_data
  Purpose: Caddy data directory (certificates, storage)
  Mount: /data (container)

caddy_config
  Purpose: Caddy configuration directory
  Mount: /config (container)

Port Mappings (docker-compose.yml - Development)
-------------------------------------------------
postgres:5432 -> host:5432
api:3001 -> host:3001
web:3000 -> host:3000

Port Mappings (docker-compose.prod.yml - Production)
-----------------------------------------------------
caddy:80 -> host:80
caddy:443 -> host:443
api:3001 (internal only, exposed not published)
web:3000 (internal only, exposed not published)

Service Names
-------------
postgres (PostgreSQL database)
api (Fastify API server)
web (Next.js web application)
caddy (Reverse proxy - production only)

Container Names
---------------
asc-postgres (PostgreSQL)
asc-api (API server)
asc-web (Web application)
asc-caddy (Reverse proxy - production only)

Image References (Production)
------------------------------
postgres:16-alpine (PostgreSQL)
caddy:2-alpine (Reverse proxy)
ghcr.io/twaynet/asc-inventory-api:${IMAGE_TAG} (API server)
ghcr.io/twaynet/asc-inventory-web:${IMAGE_TAG} (Web application)

Registry
--------
ghcr.io (GitHub Container Registry)
Repository owner: twaynet
Image naming pattern: asc-inventory-{service}

Build Arguments (apps/web/Dockerfile)
--------------------------------------
VERSION (default: dev)
BUILD_TIME (default: dev)
COMMIT_SHA (default: dev)
NEXT_PUBLIC_API_URL (default: https://beta.orthowise.dev/api)

Health Checks
-------------
postgres service
  Command: pg_isready -U postgres
  Interval: 5s
  Timeout: 5s
  Retries: 5

================================================================================
SECTION 5: HARD-CODED URLS, PORTS, AND HOSTNAMES
================================================================================

Value: http://localhost:3000
Files:
  apps/api/src/index.ts (line 77: CORS_ORIGIN default)
  apps/api/.env (line 9: CORS_ORIGIN)
  docker-compose.yml (line 36: CORS_ORIGIN)

Value: http://localhost:3001/api
Files:
  apps/web/src/lib/api/client.ts (line 20: API_BASE default)
  apps/web/.env.local (line 1: NEXT_PUBLIC_API_URL)
  apps/api/db/smoke-test-financial-readiness.ts (line 17: API_BASE default)
  apps/api/db/smoke-test-surgery-request.ts (line 16: API_BASE default)
  docker-compose.yml (line 52: NEXT_PUBLIC_API_URL)
  packages/contract/src/openapi/generate.ts (line 131: server URL)

Value: https://beta.orthowise.dev
Files:
  docker-compose.prod.yml (line 66: CORS_ORIGIN)
  apps/web/Dockerfile (line 9: NEXT_PUBLIC_API_URL build arg default)

Value: https://beta.orthowise.dev/api
Files:
  docker-compose.prod.yml (line 80: NEXT_PUBLIC_API_URL documentation)
  apps/web/Dockerfile (line 9: part of NEXT_PUBLIC_API_URL default)

Value: beta.orthowise.dev
Files:
  caddy/Caddyfile (line 1: site address)

Value: localhost
Files:
  apps/api/src/db/index.ts (line 9: DB_HOST default)

Value: 0.0.0.0
Files:
  apps/api/src/index.ts (line 63: HOST default)

Value: 3000
Files:
  apps/api/src/index.ts (line 77: in CORS_ORIGIN default)
  apps/web/src/lib/api/client.ts (line 20: in API_BASE default)
  apps/web/.env.local (line 1: in NEXT_PUBLIC_API_URL)
  apps/api/.env (line 9: in CORS_ORIGIN)
  docker-compose.yml (line 36: in CORS_ORIGIN, line 52: in NEXT_PUBLIC_API_URL, line 54: port mapping)
  caddy/Caddyfile (line 11: reverse_proxy web:3000)

Value: 3001
Files:
  apps/api/src/index.ts (line 62: PORT default)
  apps/web/src/lib/api/client.ts (line 20: in API_BASE default)
  apps/web/.env.local (line 1: in NEXT_PUBLIC_API_URL)
  apps/api/.env (line 2: PORT)
  apps/api/Dockerfile (line 50: ENV PORT=3001, line 52: EXPOSE)
  docker-compose.yml (line 29: PORT, line 38: port mapping, line 52: in NEXT_PUBLIC_API_URL)
  docker-compose.prod.yml (line 58: PORT, line 68: expose)
  caddy/Caddyfile (line 7: reverse_proxy api:3001)
  apps/api/db/smoke-test-financial-readiness.ts (line 17: in API_BASE default)
  apps/api/db/smoke-test-surgery-request.ts (line 16: in API_BASE default)
  packages/contract/src/openapi/generate.ts (line 131: in server URL)

Value: 5432
Files:
  apps/api/src/db/index.ts (line 10: DB_PORT default)
  apps/api/.env (line 4: DB_PORT)
  docker-compose.yml (line 12: port mapping, line 31: DB_PORT)
  docker-compose.prod.yml (line 60: DB_PORT)

Value: 80
Files:
  docker-compose.prod.yml (line 41: port mapping)

Value: 443
Files:
  docker-compose.prod.yml (line 42: port mapping)

Value: api (Docker service name)
Files:
  docker-compose.yml (line 22: service name)
  docker-compose.prod.yml (line 52: service name)
  caddy/Caddyfile (line 7: reverse_proxy target)

Value: web (Docker service name)
Files:
  docker-compose.yml (line 46: service name)
  docker-compose.prod.yml (line 73: service name)
  caddy/Caddyfile (line 11: reverse_proxy target)

Value: postgres (Docker service name)
Files:
  docker-compose.yml (line 4: service name, line 30: DB_HOST)
  docker-compose.prod.yml (line 20: service name, line 59: DB_HOST)

Value: /api/* (URL path prefix)
Files:
  caddy/Caddyfile (line 6: handle directive)

Value: /uploads/ (URL path prefix)
Files:
  apps/api/src/index.ts (line 98: static file serving prefix)

Value: /etc/caddy/certs/origin.pem
Files:
  caddy/Caddyfile (line 2: TLS certificate path)
  docker-compose.prod.yml (line 45: volume mount target)

Value: /etc/caddy/certs/origin-key.pem
Files:
  caddy/Caddyfile (line 2: TLS private key path)

================================================================================
END OF SNAPSHOT
================================================================================
