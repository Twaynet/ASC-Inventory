================================================================================
SNAPSHOT: EVENT AND AUDIT LOGGING MODEL (EVENTS)
Generated: 2026-02-14
Scope: Implemented event sources, persistence, types, emission, and consumption
================================================================================

A) Event sources and definitions
================================================================================
C:\Users\missp\source\repos\ASC-Inventory\packages\domain\src\types.ts
Defines: InventoryEventType, AttestationType, ChecklistType, ChecklistStatus, SignatureMethod, SurgeryRequestEventType, SurgeryRequestActorType, PhiClassification, AccessPurpose

C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\schemas\index.ts
Defines: CreateInventoryEventRequestSchema, CreateAttestationRequestSchema, CreateDeviceEventRequestSchema, SignChecklistRequestSchema

C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\auth-audit.service.ts
Defines: AuthEventType, AuthFailureReason, AuthAuditContext

C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\phi-audit.service.ts
Defines: PhiClassificationType, AccessPurposeType, AccessOutcome, PhiAccessContext

C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\case-status.service.ts
Defines: StatusTransitionContext, StatusEventRow

C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\012_case_dashboard.sql
Defines: case_event_type enum (CASE_CARD_LINKED, CASE_CARD_CHANGED, READINESS_ATTESTED, READINESS_VOIDED, OVERRIDE_ADDED, OVERRIDE_MODIFIED, OVERRIDE_REMOVED, SCHEDULING_CHANGED, ANESTHESIA_PLAN_CHANGED, CASE_CREATED, CASE_ACTIVATED, CASE_CANCELLED)

B) Event persistence tables (DB)
================================================================================
Table name: inventory_event
Defining migration: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\001_initial_schema.sql
Key columns: id, facility_id, inventory_item_id, event_type (inventory_event_type), case_id, location_id, previous_location_id, sterility_status, notes, performed_by_user_id, device_event_id, occurred_at, created_at
Append-only enforcement: prevent_modification() trigger (inventory_event_no_update, inventory_event_no_delete) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\001_initial_schema.sql

Table name: attestation
Defining migration: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\001_initial_schema.sql
Key columns: id, facility_id, case_id, type (attestation_type), attested_by_user_id, readiness_state_at_time, notes, created_at
Append-only enforcement: prevent_modification() trigger (attestation_no_update, attestation_no_delete) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\001_initial_schema.sql

Table name: device_event
Defining migration: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\001_initial_schema.sql
Key columns: id, facility_id, device_id, device_type, payload_type, raw_value, processed_item_id, processed, processing_error, occurred_at, created_at
Append-only enforcement: prevent_modification() trigger (device_event_no_update, device_event_no_delete) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\001_initial_schema.sql

Table name: case_checklist_response
Defining migration: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\004_timeout_debrief.sql
Key columns: id, instance_id, item_key, value, completed_by_user_id, completed_at, created_at
Append-only enforcement: prevent_modification() trigger (case_checklist_response_no_update, case_checklist_response_no_delete) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\004_timeout_debrief.sql

Table name: case_checklist_signature
Defining migration: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\004_timeout_debrief.sql
Key columns: id, instance_id, role, signed_by_user_id, signed_at, method (signature_method), created_at
Append-only enforcement: prevent_modification() trigger (case_checklist_signature_no_update, case_checklist_signature_no_delete) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\004_timeout_debrief.sql

Table name: case_event_log
Defining migration: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\012_case_dashboard.sql
Key columns: id, case_id, facility_id, event_type (case_event_type), user_id, user_role, user_name, description, override_id, case_card_version_id, created_at
Append-only enforcement: prevent_modification() trigger (case_event_log_no_update, case_event_log_no_delete) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\012_case_dashboard.sql

Table name: surgical_case_status_event
Defining migration: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\036_case_status_events.sql
Key columns: id, surgical_case_id, from_status, to_status, reason, context (JSONB), actor_user_id, created_at
Append-only enforcement: prevent_modification() trigger (case_status_event_no_update, case_status_event_no_delete) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\036_case_status_events.sql

Table name: catalog_event
Defining migration: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\037_catalog_event.sql
Key columns: id, facility_id, catalog_item_id, action (TEXT), actor_user_id, payload (JSONB), created_at
Append-only enforcement: prevent_modification() trigger (catalog_event_no_update, catalog_event_no_delete) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\037_catalog_event.sql

Table name: auth_audit_log
Defining migration: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\048_auth_audit_log.sql
Key columns: id, event_type (VARCHAR), facility_id, user_id, username, user_roles (TEXT[]), success, failure_reason, request_id, ip_address, user_agent, created_at
Append-only enforcement: prevent_modification() trigger (auth_audit_log_no_update, auth_audit_log_no_delete) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\048_auth_audit_log.sql

Table name: case_card_link_event
Defining migration: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\049_case_card_link_events.sql
Key columns: id, case_id, facility_id, action (VARCHAR), source_case_card_id, source_case_card_version_id, snapshot_json (JSONB), reason_code, reason_note, performed_by_user_id, performed_by_name, performed_at, created_at
Append-only enforcement: prevent_modification() trigger (case_card_link_event_no_update, case_card_link_event_no_delete) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\049_case_card_link_events.sql

Table name: phi_access_audit_log
Defining migration: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\054_phi_access_audit_log.sql
Key columns: id, user_id, user_roles (TEXT[]), facility_id, organization_ids (UUID[]), case_id, phi_classification, access_purpose, outcome, denial_reason, request_id, endpoint, http_method, created_at
Append-only enforcement: prevent_modification() trigger (phi_access_audit_log_no_update, phi_access_audit_log_no_delete) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\054_phi_access_audit_log.sql
Extended columns (Phase 3): is_emergency, emergency_justification — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\055_phi_phase3_audit_extensions.sql
Extended columns (Phase 4): breach_context (JSONB) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\056_phi_phase4_retention_breach.sql

Table name: phi_export_audit_log
Defining migration: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\055_phi_phase3_audit_extensions.sql
Key columns: id, phi_access_log_id, export_format (VARCHAR), export_row_count (INTEGER), created_at
Append-only enforcement: prevent_modification() trigger (phi_export_audit_log_no_update, phi_export_audit_log_no_delete) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\055_phi_phase3_audit_extensions.sql

C) Event types/enums
================================================================================
Name: inventory_event_type
Values: RECEIVED, VERIFIED, LOCATION_CHANGED, RESERVED, RELEASED, CONSUMED, EXPIRED, RETURNED, ADJUSTED
Defining file: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\001_initial_schema.sql (DB enum)
Defining file: C:\Users\missp\source\repos\ASC-Inventory\packages\domain\src\types.ts (TypeScript enum)
Consumed: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\repositories\postgres\inventory.repository.ts, C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\inventory.routes.ts, C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\schemas\index.ts

Name: attestation_type
Values: CASE_READINESS, SURGEON_ACKNOWLEDGMENT
Defining file: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\001_initial_schema.sql (DB enum)
Defining file: C:\Users\missp\source\repos\ASC-Inventory\packages\domain\src\types.ts (TypeScript enum)
Consumed: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\readiness.routes.ts, C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\case-dashboard.routes.ts, C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\schemas\index.ts

Name: case_event_type
Values: CASE_CARD_LINKED, CASE_CARD_CHANGED, READINESS_ATTESTED, READINESS_VOIDED, OVERRIDE_ADDED, OVERRIDE_MODIFIED, OVERRIDE_REMOVED, SCHEDULING_CHANGED, ANESTHESIA_PLAN_CHANGED, CASE_CREATED, CASE_ACTIVATED, CASE_CANCELLED
Defining file: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\012_case_dashboard.sql (DB enum)
Consumed: UNKNOWN (no TypeScript application-level usage found; DB-only definition)

Name: checklist_type
Values: TIMEOUT, DEBRIEF
Defining file: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\004_timeout_debrief.sql (DB enum)
Defining file: C:\Users\missp\source\repos\ASC-Inventory\packages\domain\src\types.ts (TypeScript enum)
Consumed: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\checklists.routes.ts, C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\checklists.service.ts

Name: signature_method
Values: LOGIN, PIN, BADGE, KIOSK_TAP
Defining file: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\004_timeout_debrief.sql (DB enum)
Defining file: C:\Users\missp\source\repos\ASC-Inventory\packages\domain\src\types.ts (TypeScript enum)
Consumed: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\checklists.service.ts, C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\schemas\index.ts

Name: phi_classification
Values: PHI_CLINICAL, PHI_BILLING, PHI_AUDIT
Defining file: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\054_phi_access_audit_log.sql (DB enum)
Defining file: C:\Users\missp\source\repos\ASC-Inventory\packages\domain\src\types.ts (TypeScript enum)
Consumed: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\plugins\phi-guard.ts, C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\phi-audit.service.ts

Name: access_purpose
Values: CLINICAL_CARE, SCHEDULING, BILLING, AUDIT, EMERGENCY
Defining file: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\054_phi_access_audit_log.sql (DB enum)
Defining file: C:\Users\missp\source\repos\ASC-Inventory\packages\domain\src\types.ts (TypeScript enum)
Consumed: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\plugins\phi-guard.ts, C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\phi-audit.service.ts

Name: access_outcome
Values: ALLOWED, DENIED
Defining file: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\054_phi_access_audit_log.sql (DB enum)
Consumed: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\phi-audit.service.ts (TypeScript: AccessOutcome type)

Name: AuthEventType
Values: LOGIN_SUCCESS, LOGIN_FAILED, LOGOUT
Defining file: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\auth-audit.service.ts (TypeScript type, stored as VARCHAR in DB)
Consumed: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\auth-audit.service.ts

Name: SurgeryRequestEventType
Values: SUBMITTED, RESUBMITTED, RETURNED, ACCEPTED, REJECTED, WITHDRAWN, CONVERTED
Defining file: C:\Users\missp\source\repos\ASC-Inventory\packages\domain\src\types.ts (TypeScript enum)
Consumed: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\surgery-request.service.ts

D) Emission points (who writes events)
================================================================================
Event table: inventory_event
Emitting API routes: POST /inventory/events — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\inventory.routes.ts
Emitting API routes: POST /inventory/events/bulk — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\inventory.routes.ts
Emitting API routes: POST /inventory/events/financial — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\inventory.routes.ts
Emitting repository: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\repositories\postgres\inventory.repository.ts (INSERT INTO inventory_event)
Required auth: JWT token, request.user.userId, request.user.facilityId — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\inventory.routes.ts

Event table: attestation
Emitting API routes: POST /readiness/attestations — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\readiness.routes.ts
Emitting API routes: POST /readiness/attestations/:id/void — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\readiness.routes.ts
Emitting routes: POST (case-dashboard routes) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\case-dashboard.routes.ts
Required auth: JWT token, request.user.userId, request.user.facilityId — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\readiness.routes.ts

Event table: device_event
Emitting API routes: POST /inventory/device-events — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\inventory.routes.ts
Emitting repository: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\repositories\postgres\device.repository.ts
Required auth: JWT token, request.user.userId, request.user.facilityId — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\inventory.routes.ts

Event table: case_checklist_response
Emitting API routes: POST /cases/:id/checklists/:type/respond — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\checklists.routes.ts
Emitting service: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\checklists.service.ts (INSERT INTO case_checklist_response)
Required auth: JWT token, request.user.userId, request.user.facilityId — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\checklists.routes.ts

Event table: case_checklist_signature
Emitting API routes: POST /cases/:id/checklists/:type/sign — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\checklists.routes.ts
Emitting service: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\checklists.service.ts (INSERT INTO case_checklist_signature)
Required auth: JWT token, request.user.userId, request.user.roles — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\checklists.routes.ts

Event table: case_event_log
Emitting routes: UNKNOWN (no direct INSERT found; table defined but unused)
Required auth: UNKNOWN

Event table: surgical_case_status_event
Emitting service: recordStatusEvent() — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\case-status.service.ts
Emitting API routes: POST /cases — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\cases.routes.ts
Emitting API routes: POST /cases/:caseId/approve — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\cases.routes.ts
Emitting API routes: POST /cases/:caseId/reject — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\cases.routes.ts
Emitting API routes: POST /cases/:caseId/activate — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\cases.routes.ts
Emitting API routes: POST /cases/:caseId/cancel — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\cases.routes.ts
Emitting API routes: POST /cases/:caseId/check-in-preop — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\cases.routes.ts
Required auth: JWT token, request.user.userId passed to recordStatusEvent() — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\case-status.service.ts

Event table: catalog_event
Emitting API routes: POST /catalog/:catalogId/images — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\catalog-images.routes.ts
Emitting API routes: DELETE /catalog/:catalogId/images/:imageId — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\catalog-images.routes.ts
Emitting routes: catalog.routes.ts (INSERT INTO catalog_event) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\catalog.routes.ts
Required auth: JWT token, request.user.userId, request.user.facilityId — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\catalog.routes.ts

Event table: auth_audit_log
Emitting service: logAuthEvent() — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\auth-audit.service.ts
Emitting API routes: POST /auth/login, POST /auth/logout (via logAuthEvent call)
Required auth: None (auth events record login/logout attempts themselves)

Event table: case_card_link_event
Emitting API routes: POST (case-dashboard routes) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\case-dashboard.routes.ts (INSERT INTO case_card_link_event)
Required auth: JWT token, request.user.userId, request.user.facilityId — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\case-dashboard.routes.ts

Event table: phi_access_audit_log
Emitting service: logPhiAccess() — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\phi-audit.service.ts
Emitting plugin: phi-guard.ts (via logPhiAccess call on every PHI-classified request) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\plugins\phi-guard.ts
Required auth: JWT token, request.user.userId, request.user.roles, request.user.facilityId — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\plugins\phi-guard.ts

Event table: phi_export_audit_log
Emitting service: logPhiExport() — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\phi-audit.service.ts
Emitting routes: UNKNOWN (no direct caller found; service function defined)
Required auth: UNKNOWN (linked to phi_access_audit_log entry)

E) Read/consumption points (who reads events)
================================================================================
Event table: inventory_event
API endpoints: GET /inventory/events (query by item, case, facility) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\inventory.routes.ts
API endpoints: GET /reports/inventory-ledger (aggregate inventory events) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\reports.routes.ts
Web pages: C:\Users\missp\source\repos\ASC-Inventory\apps\web\src\app\(app)\admin\devices\events\page.tsx (device events display)
Web pages: C:\Users\missp\source\repos\ASC-Inventory\apps\web\src\app\(app)\admin\inventory\check-in\page.tsx (inventory event context)
Aggregation: readiness.service.ts (consumes last_verified_at derived from inventory_event) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\readiness.service.ts

Event table: attestation
API endpoints: GET /readiness/cases/:caseId/attestations — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\readiness.routes.ts
API endpoints: GET /readiness/day-before/:date (includes attestation flags) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\readiness.routes.ts
Web pages: C:\Users\missp\source\repos\ASC-Inventory\apps\web\src\app\(app)\admin\reports\page.tsx (attestation display in reports)
Aggregation: case_readiness_cache table (has_attestation, attested_at derived from attestation table)

Event table: device_event
API endpoints: GET /inventory/device-events — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\inventory.routes.ts
Web pages: C:\Users\missp\source\repos\ASC-Inventory\apps\web\src\app\(app)\admin\devices\events\page.tsx (device events page)

Event table: case_checklist_response
API endpoints: GET /cases/:id/checklists (returns responses as part of checklist instance) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\checklists.routes.ts
Web pages: UNKNOWN (consumed via checklist instance API, no direct page component found)

Event table: case_checklist_signature
API endpoints: GET /cases/:id/checklists (returns signatures as part of checklist instance) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\checklists.routes.ts
Web pages: UNKNOWN (consumed via checklist instance API, no direct page component found)

Event table: case_event_log
API endpoints: UNKNOWN (no read endpoint found)
Web pages: UNKNOWN (no consumption found)

Event table: surgical_case_status_event
API endpoints: getStatusEvents() service function — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\case-status.service.ts
Web pages: UNKNOWN (service function exists but no API route or page component found)

Event table: catalog_event
API endpoints: UNKNOWN (no read endpoint found)
Web pages: UNKNOWN (no consumption found)

Event table: auth_audit_log
API endpoints: getAuthAuditLog() service function — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\auth-audit.service.ts
Web pages: C:\Users\missp\source\repos\ASC-Inventory\apps\web\src\app\(app)\platform\auth-audit\page.tsx (auth audit log page)

Event table: case_card_link_event
API endpoints: UNKNOWN (no read endpoint found)
Web pages: UNKNOWN (no consumption found)

Event table: phi_access_audit_log
API endpoints: getPhiAccessLog(), getPhiAccessLogEntry(), getPhiAccessStats() — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\phi-audit.service.ts
Web pages: UNKNOWN (service functions exist; no web page component found in search scope)

Event table: phi_export_audit_log
API endpoints: getPhiAccessStats() (includes exportCount aggregation) — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\phi-audit.service.ts
Web pages: UNKNOWN (consumed via stats aggregation)

F) Event-to-state effects (factual only)
================================================================================
Base table: inventory_item
State field: last_verified_at
Implementation: Updated when inventory_event.event_type = VERIFIED is inserted — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\repositories\postgres\inventory.repository.ts
Implementation: No automatic trigger; application code updates inventory_item.last_verified_at when creating VERIFIED event

Base table: inventory_item
State field: availability_status, location_id
Implementation: Updated when inventory_event.event_type = LOCATION_CHANGED, RESERVED, RELEASED, CONSUMED — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\repositories\postgres\inventory.repository.ts
Implementation: No automatic trigger; application code updates inventory_item state when creating event

Base table: case_readiness_cache
State refresh: Cache invalidation triggered on inventory_event, attestation writes
Implementation: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\readiness.service.ts (cache refresh logic)
Implementation: No DB trigger; application-level cache refresh after event writes

Base table: surgical_case
State field: status
Implementation: surgical_case.status is updated simultaneously with surgical_case_status_event insertion — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\case-status.service.ts
Implementation: recordStatusEvent() is called after surgical_case.status UPDATE; no automatic trigger

Base table: surgical_case
State field: attestation_state, attestation_void_reason
Implementation: Updated when attestation record is created or voided — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\readiness.routes.ts
Implementation: Application code updates surgical_case attestation fields after inserting attestation event

Base table: case_checklist_instance
State field: status, completed_at
Implementation: Updated when case_checklist_signature is written and all required signatures are present — C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\checklists.service.ts
Implementation: Application code updates case_checklist_instance.status after signature insertion

G) Traceability fields
================================================================================
Event table: inventory_event
Actor attribution: performed_by_user_id
Correlation: inventory_item_id, case_id, device_event_id, facility_id
Timestamp: occurred_at, created_at
File path: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\repositories\postgres\inventory.repository.ts

Event table: attestation
Actor attribution: attested_by_user_id
Correlation: case_id, facility_id
Timestamp: created_at
File path: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\readiness.routes.ts, C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\case-dashboard.routes.ts

Event table: device_event
Actor attribution: None (device-initiated events, no user attribution)
Correlation: device_id, facility_id, processed_item_id
Timestamp: occurred_at, created_at
File path: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\repositories\postgres\device.repository.ts

Event table: case_checklist_response
Actor attribution: completed_by_user_id
Correlation: instance_id, item_key
Timestamp: completed_at, created_at
File path: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\checklists.service.ts

Event table: case_checklist_signature
Actor attribution: signed_by_user_id, role
Correlation: instance_id
Timestamp: signed_at, created_at
File path: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\checklists.service.ts

Event table: case_event_log
Actor attribution: user_id, user_role, user_name
Correlation: case_id, facility_id, override_id, case_card_version_id
Timestamp: created_at
File path: C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\012_case_dashboard.sql

Event table: surgical_case_status_event
Actor attribution: actor_user_id
Correlation: surgical_case_id, context (JSONB)
Timestamp: created_at
File path: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\case-status.service.ts

Event table: catalog_event
Actor attribution: actor_user_id
Correlation: catalog_item_id, facility_id, payload (JSONB)
Timestamp: created_at
File path: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\catalog.routes.ts, C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\catalog-images.routes.ts

Event table: auth_audit_log
Actor attribution: user_id, username, user_roles (TEXT[])
Correlation: facility_id, request_id, ip_address, user_agent
Timestamp: created_at
File path: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\auth-audit.service.ts

Event table: case_card_link_event
Actor attribution: performed_by_user_id, performed_by_name
Correlation: case_id, facility_id, source_case_card_id, source_case_card_version_id
Timestamp: performed_at, created_at
File path: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\routes\case-dashboard.routes.ts

Event table: phi_access_audit_log
Actor attribution: user_id, user_roles (TEXT[])
Correlation: facility_id, organization_ids (UUID[]), case_id, request_id, endpoint, http_method
Timestamp: created_at
File path: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\phi-audit.service.ts

Event table: phi_export_audit_log
Actor attribution: Inherited from phi_access_audit_log (linked by phi_access_log_id)
Correlation: phi_access_log_id
Timestamp: created_at
File path: C:\Users\missp\source\repos\ASC-Inventory\apps\api\src\services\phi-audit.service.ts

H) Inconsistencies or gaps (factual only)
================================================================================
Mixed timestamp conventions:
- inventory_event, device_event: occurred_at + created_at (explicit event time vs. log time)
- attestation, case_checklist_response, case_checklist_signature, catalog_event, auth_audit_log, phi_access_audit_log, phi_export_audit_log, surgical_case_status_event: created_at only (no explicit occurred_at)
- case_checklist_signature: signed_at + created_at (mirrors occurred_at pattern but named differently)
- case_card_link_event: performed_at + created_at (mirrors occurred_at pattern but named differently)

Actor attribution field naming inconsistencies:
- inventory_event: performed_by_user_id
- attestation: attested_by_user_id
- case_checklist_response: completed_by_user_id
- case_checklist_signature: signed_by_user_id
- catalog_event, surgical_case_status_event: actor_user_id
- case_event_log: user_id
- case_card_link_event: performed_by_user_id
- auth_audit_log, phi_access_audit_log: user_id

Event enums defined but not used in application code:
- case_event_type: Defined in C:\Users\missp\source\repos\ASC-Inventory\apps\api\db\migrations\012_case_dashboard.sql but no TypeScript enum or INSERT/SELECT queries found

Event tables with no consumption endpoint:
- case_event_log: Table exists, append-only enforced, but no API endpoint or service function to query events
- catalog_event: Table exists, write emissions found, but no API endpoint to retrieve catalog event history
- case_card_link_event: Table exists, write emissions found, but no API endpoint to retrieve link event history
- surgical_case_status_event: Table exists, getStatusEvents() service function exists, but no API route exposes it

Tables with missing user attribution (device-initiated or system events):
- device_event: No user attribution (device-initiated events); processed_item_id links to resolved inventory item

Duplicated event concepts:
- attestation table (original LAW v1.0) vs. surgical_case.attestation_state (mutable projection added in v1.1) — dual storage of attestation state
- case_event_log (defined for case dashboard events) vs. surgical_case_status_event (case status transitions) — both record case-level events but for different purposes

Event types stored as TEXT vs. DB enum:
- catalog_event.action: TEXT (no enum constraint)
- case_card_link_event.action: VARCHAR with CHECK constraint (LINKED, UNLINKED, RELINKED)
- auth_audit_log.event_type: VARCHAR (LOGIN_SUCCESS, LOGIN_FAILED, LOGOUT defined in TypeScript only)
- surgical_case_status_event.from_status, to_status: TEXT (no enum constraint; case_status enum exists but not enforced here)

================================================================================
END OF SNAPSHOT
================================================================================
